{% extends "base.html" %}
{% load i18n %}
{% load is_bbb_mod %}

{% block content %}
<main class="container py-4">
	{% if announcements %}
	<h1><i class="fa fa-bullhorn"></i> {% if LANGUAGE_CODE == "de" %}Ankündigungen{% else %}Announcements{% endif %}</h1>
	{% for announcement in announcements %}
	<div class="row">
		<div class="col py-1">
			{{ announcement.html|safe }}
		</div>
	</div>

	<hr />
	{% endfor %}
	{% endif %}

	<h1><i class="fa fa-tv"></i> {% if LANGUAGE_CODE == "de" %}Vorträge{% else %}Lectures{% endif %}</h1>

	<div class="row">
		{% for room in event_rooms %}
		{% if room.bbb or room.stream %}
		<div class="col-sm-{{ room.view_size }} col-12 py-1">
			{% if not room.bbb or room.bbb.get_stats.running %}
			<a class="btn btn-primary btn-lg w-100" href="{{ room.link }}" role="button">
				{{ room.name }}
			</a>
			{% elif room.bbb and room.bbb|is_bbb_mod:request.user %}
			<a class="btn btn-secondary btn-lg w-100" href="{{ room.link }}" role="button">
				{{ room.name }}
			</a>
			{% else %}
			<div class="btn btn-secondary btn-lg w-100 disabled">
				{{ room.name }}
			</div>
			{% endif %}

			{% with room.current_event as event %}
			{% if event %}
			<div class="small">{{ event.start|date:'H:i' }} - {{ event.end|date:'H:i' }}</div>
			<div><a href="{{ event.link }}">{{ event.title }}</a></div>
			<div class="small">{{ event.persons_html|safe }}</div>
			{% endif %}
			{% endwith %}

			{% with room.next_event as event %}
			{% if event %}
			<div class="small">
				<i class="fa fa-fast-forward"></i> <a href="{{ event.link }}">{{ event.start|date:'H:i' }} - {{ event.end|date:'H:i' }} {{ event.title }}</a></div>
			{% endif %}
			{% endwith %}

			{% if room.bbb %}
			{% with room.bbb.get_stats as stats %}
			<div class="small">
				{% if stats.running %}
					<i class="fa fa-user"></i> {{ stats.participants }}
				{% elif not room.current_event %}
					<i class="fa fa-user-slash"></i> {{ stats.participants }}
				{% endif %}
			</div>
			{% endwith %}
			{% endif %}
		</div>
		{% endif %}
		{% endfor %}
	</div>
	
	<hr />

	<div class="row">
		<div class="col-sm-6 col-12 py-1">
			<a class="btn btn-primary btn-lg w-100" href="/chat/lobby" role="button">
				<i class="fa fa-comment-alt"></i> Chat
			</a>
		</div>
		<div class="col-sm-6 col-12 py-1">
			<a class="btn btn-primary btn-lg w-100" href="https://programm.froscon.de" role="button">
				<i class="fa fa-calendar-alt"></i> {% if LANGUAGE_CODE == "de" %}Fahrplan{% else %}Schedule{% endif %}
			</a>
		</div>
	</div>

	<hr />

	{% if workshops %}
	<h1><i class="fa fa-wrench"></i> Workshops</h1>
	{% for workshop in workshops %}
	{% if workshop.bbb %}
	<div class="row">
		<div class="col-sm-8 col-12 py-1">
			<span style='font-size:12px'>{{ workshop.start|date:'H:i' }} - {{ workshop.end|date:'H:i' }}</span><br/>
			{% if workshop.nextup %}Next Up: {% endif %}{{ workshop.title }}<br/>
			<span style='font-size:12px'>{{ workshop.persons_html|safe }}</span>
		</div>
		<div class="col-sm-4 col-12 py-1">
			{% if workshop.bbb.get_stats.running %}
			<a class="btn btn-primary btn-lg w-100" href="{{ workshop.bbb.link }}" role="button">
				<div class="d-flex w-100">
					<div class="mx-auto">
						Join
					</div>
					<div>
						| <i class="fa fa-user"></i> {{ stats.participants }}
					</div>
				</div>
			</a>
			{% elif workshop.bbb|is_bbb_mod:request.user %}
			<a class="btn btn-primary btn-lg w-100" href="{{ workshop.bbb.link }}" role="button">
				<div class="d-flex w-100">
					<div class="mx-auto">
						Join
					</div>
					<div>
						| <i class="fa fa-user-slash"></i> 0
					</div>
				</div>
			</a>
			{% else %}
			<a class="btn btn-secondary btn-lg w-100 disabled" href role="button">
				<div class="d-flex w-100">
					<div class="mx-auto">
						Join
					</div>
					<div>
						| <i class="fa fa-user-slash"></i> {{ stats.participants }}
					</div>
				</div>
			</a>
			{% endif %}
		</div>
	</div>
	<div class="border-top my-3"></div>
	{% endif %}
	{% endfor %}
	{% endif %}

	{% if hangouts %}
	<h1><i class="fa fa-comments"></i> Community</h1>
	<div class="row">
		{% for hangout in hangouts %}
		<div class="col-sm-6 col-12">
			{% with hangout.get_stats as stats %}
			{% if stats.running %}
			<a class="btn btn-primary btn-lg w-100" href="{{ hangout.link }}" role="button">
				{{ hangout.name }}
			</a>
			{% elif hangout|is_bbb_mod:request.user or hangout.start_as_guest %}
			<a class="btn btn-secondary btn-lg w-100" href="{{ hangout.link }}" role="button">
				{{ hangout.name }}
			</a>
			{% else %}
			<div class="btn btn-secondary btn-lg w-100 disabled">
				{{ hangout.name }}
			</div>
			{% endif %}
			<br/>
			<center>
				<span style='font-size:12px'>
					{% if stats.running %}
						<i class="fa fa-user"></i> {{ stats.participants }}
					{% else %}
						{% if LANGUAGE_CODE == "de" %}Dieser Raum ist leer{% else %}This room is empty{% endif %}
					{% endif %}
				</span>
			</center>
			{% endwith %}
		</div>
		{% endfor %}
	</div>
	<div class="border-top my-3"></div>
	{% endif %}

	{% if partners %}
	<div class="d-flex w-100">
		<div>
			<h1><i class="fa fa-user-friends"></i> {% if LANGUAGE_CODE == "de" %}Standpartner{% else %}Venue Partners{% endif %}</h1>
		</div>
		<div class="ml-auto">
			<a class="btn btn-secondary ml-auto" href="https://www.froscon.de/partner/jobwall/">
				Job Wall
				<i class="fa fa-angle-double-right"></i>
			</a>
		</div>
	</div>
	<div class="row align-items-center align-content-around text-center mb-10 w-100">
		{% for partner in partners %}
		<div class="d-flex mx-auto flex-column align-self-stretch pt-3 px-2">
			<figure class="flex-grow-1 d-flex align-items-center align-self-center partner-logo">
				<a href="{{ partner.link }}" {% if partner.bbb.get_stats.running %}class="partner-online{% endif %}"  title="{{ partner.name }}">
					<img src="{{ partner.logo.url }}" alt="{{ partner.name }}">
				</a>
			</figure>
			<div>
				{% if partner.bbb.get_stats.running %}
				<a class="btn btn-primary btn-small w-100" href="{{ partner.bbb.link }}">Join</a>
				{% else %}
				<a class="btn btn-primary btn-small disabled w-100" href disabled>Offline</a>
				{% endif %}
			</div>
		</div>
		{% endfor %}
	</div>
	{% endif %}

</main>
{% endblock %}
